{% comment %}
  Theme App Extension: Recipe Generator Button
  右下フローティングボタンでレシピ生成機能を提供
{% endcomment %}

<!-- 動的スタイル：Editor設定を反映 -->
<style>
  .floating-button-container {
    {{ block.settings.button_position_vertical }}: {{ block.settings.button_offset_vertical }}px;
    {{ block.settings.button_position_horizontal }}: {{ block.settings.button_offset_horizontal }}px;
  }

  .floating-toggle-btn {
    width: {{ block.settings.button_size }}px;
    height: {{ block.settings.button_size }}px;
    background: {{ block.settings.button_bg_color }};
  }

  .floating-toggle-btn:hover {
    background: {{ block.settings.button_hover_color }};
  }

  .button-text {
    color: {{ block.settings.button_text_color }};
  }

  {% if block.settings.button_image != blank %}
  .floating-toggle-btn .button-text {
    display: none;
  }

  .floating-toggle-btn {
    background-image: url('{{ block.settings.button_image | img_url: 'medium' }}');
    background-size: cover;
    background-position: center;
  }
  {% endif %}
</style>

<!-- フローティングボタン -->
<!-- デバッグ用：条件分岐を一時的にコメントアウト -->
<!-- {% if block.settings.show_floating_button %} -->
<div class="floating-button-container">
  <button class="floating-toggle-btn" onclick="toggleFormWindow()">
    <span class="button-text">{{ block.settings.button_text | default: '？' }}</span>
  </button>
</div>
<!-- {% endif %} -->

<!-- ポップアップフォームウィンドウ -->
<div class="form-popup-window" id="formPopupWindow">
  <div class="form-popup-content">
    <div class="form-popup-header">
      <h3>{{ block.settings.popup_title | default: 'パーソナルKOJIレシピ提案' }}</h3>
      <button class="form-close-btn" onclick="toggleFormWindow()">×</button>
    </div>

    <div class="form-popup-body">
      <p class="form-subtitle">
        {{ block.settings.subtitle | default: 'あなたの今の体調や食事の希望に合わせて<br>MUROの麹製品を使った特別なレシピをご提案します' }}
      </p>

      <form id="kojiRecipeForm">
        <div class="form-group">
          <label for="userConditionInput">{{ block.settings.condition_label | default: '現在の体調やお悩み(必須)' }}</label>
          <label for="userConditionInput">[例: 疲れやすい, 胃腸が弱り気味]</label>
          <textarea id="userConditionInput" placeholder="{{ block.settings.condition_placeholder | default: '例：最近、夏バテ気味で食欲がない' }}" required></textarea>
        </div>

        <div class="form-group">
          <label for="dietaryNeedsInput">{{ block.settings.dietary_label | default: '食事で気をつけたいこと（任意）' }}</label>
          <label for="dietaryNeedsInput">[例: 低カロリー, 消化の良いもの]</label>
          <input type="text" id="dietaryNeedsInput" placeholder="{{ block.settings.dietary_placeholder | default: '例：ビタミンB群を多く摂りたい' }}">
        </div>

        <div class="form-group">
          <label for="kojiTypeSelect">{{ block.settings.koji_label | default: '使用したいMUROの麹製品（任意）' }}</label>
          <select id="kojiTypeSelect">
            <option value="">AIにおまかせ</option>
            <option value="麹パウダー">麹パウダー</option>
            <option value="塩麹">塩麹</option>
            <option value="醤油麹">醤油麹</option>
            <option value="甘麹">甘麹</option>
            <option value="トマト麹">トマト麹</option>
            <option value="ハーブ麹">ハーブ麹</option>
            <option value="にんにく麹">にんにく麹</option>
            <option value="玉ねぎ麹">玉ねぎ麹</option>
          </select>
        </div>

        <div class="form-group">
          <label for="otherIngredientsInput">{{ block.settings.ingredients_label | default: '使いたい食材（任意）' }}</label>
          <input type="text" id="otherIngredientsInput" placeholder="{{ block.settings.ingredients_placeholder | default: '例：鶏むね肉、豆腐' }}">
        </div>

        <button type="submit" id="generateRecipeBtn" class="submit-button">
          麹レシピ生成
        </button>
      </form>

      <div id="loadingIndicator" class="loading-container hidden">
        <div class="loading-spinner"></div>
        <p class="loading-text">{{ block.settings.loading_text | default: 'レシピを作成しています...' }}</p>
      </div>

      <div id="errorMessage" class="error-container hidden">
        <p class="error-text"></p>
      </div>
    </div>
  </div>
</div>

<!-- レシピ表示モーダル -->
<div id="recipeModal" class="recipe-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">{{ block.settings.modal_title | default: 'あなたのためのレシピ' }}</h2>
      <button class="modal-close" onclick="closeRecipeModal()">×</button>
    </div>

    <div class="modal-body">
      <!-- レシピ1 -->
      <div id="recipePage1" class="recipe-page active">
        <h3 class="recipe-name" id="recipe1Name"></h3>
        <div class="recipe-section">
          <h4 class="recipe-section-title">材料</h4>
          <div class="recipe-ingredients recipe-content" id="recipe1Ingredients"></div>
        </div>
        <div class="recipe-section">
          <h4 class="recipe-section-title">作り方</h4>
          <div class="recipe-steps recipe-content" id="recipe1Steps"></div>
        </div>
        <div class="recipe-section">
          <h4 class="recipe-section-title">このレシピの特徴</h4>
          <div class="recipe-benefit recipe-content" id="recipe1Benefit"></div>
        </div>
      </div>

      <!-- レシピ2 -->
      <div id="recipePage2" class="recipe-page">
        <h3 class="recipe-name" id="recipe2Name"></h3>
        <div class="recipe-section">
          <h4 class="recipe-section-title">材料</h4>
          <div class="recipe-ingredients recipe-content" id="recipe2Ingredients"></div>
        </div>
        <div class="recipe-section">
          <h4 class="recipe-section-title">作り方</h4>
          <div class="recipe-steps recipe-content" id="recipe2Steps"></div>
        </div>
        <div class="recipe-section">
          <h4 class="recipe-section-title">このレシピの特徴</h4>
          <div class="recipe-benefit recipe-content" id="recipe2Benefit"></div>
        </div>
      </div>

      <!-- レシピ3 -->
      <div id="recipePage3" class="recipe-page">
        <h3 class="recipe-name" id="recipe3Name"></h3>
        <div class="recipe-section">
          <h4 class="recipe-section-title">材料</h4>
          <div class="recipe-ingredients recipe-content" id="recipe3Ingredients"></div>
        </div>
        <div class="recipe-section">
          <h4 class="recipe-section-title">作り方</h4>
          <div class="recipe-steps recipe-content" id="recipe3Steps"></div>
        </div>
        <div class="recipe-section">
          <h4 class="recipe-section-title">このレシピの特徴</h4>
          <div class="recipe-benefit recipe-content" id="recipe3Benefit"></div>
        </div>
      </div>
    </div>

    <div class="modal-pagination">
      <button class="pagination-btn prev" onclick="changeRecipePage(-1)" id="prevBtn">
        前のレシピ
      </button>
      <span class="page-indicator" id="pageIndicator">1 / 3</span>
      <button class="pagination-btn next" onclick="changeRecipePage(1)" id="nextBtn">
        次のレシピ
      </button>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "KOJIレシピ生成",
  "target": "body",
  "stylesheet": "recipe-modal.css",
  "javascript": "recipe-modal.js",
  "settings": [
    {
      "type": "header",
      "content": "レシピ生成設定"
    },
    {
      "type": "checkbox",
      "id": "show_floating_button",
      "label": "フローティングボタンを表示",
      "default": true
    },
    {
      "type": "header",
      "content": "ボタン外観設定"
    },
    {
      "type": "range",
      "id": "button_size",
      "label": "ボタンサイズ",
      "min": 48,
      "max": 120,
      "step": 4,
      "default": 72,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "ボタン背景色",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_hover_color",
      "label": "ボタンホバー色",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "テキスト色",
      "default": "#FFFFFF"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "フローティングボタンテキスト",
      "default": "？",
      "info": "ボタンに表示するテキスト（絵文字や短いテキスト推奨）。画像を設定した場合は非表示になります。"
    },
    {
      "type": "image_picker",
      "id": "button_image",
      "label": "ボタン画像",
      "info": "画像を設定するとテキストの代わりに画像が表示されます"
    },
    {
      "type": "header",
      "content": "ボタン位置設定"
    },
    {
      "type": "select",
      "id": "button_position_vertical",
      "label": "縦位置",
      "options": [
        {
          "value": "bottom",
          "label": "下"
        },
        {
          "value": "top",
          "label": "上"
        }
      ],
      "default": "bottom"
    },
    {
      "type": "range",
      "id": "button_offset_vertical",
      "label": "縦方向の余白",
      "min": 10,
      "max": 100,
      "step": 5,
      "default": 30,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "button_position_horizontal",
      "label": "横位置",
      "options": [
        {
          "value": "left",
          "label": "左"
        },
        {
          "value": "right",
          "label": "右"
        }
      ],
      "default": "right"
    },
    {
      "type": "range",
      "id": "button_offset_horizontal",
      "label": "横方向の余白",
      "min": 10,
      "max": 100,
      "step": 5,
      "default": 30,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "表示テキスト設定"
    },
    {
      "type": "text",
      "id": "popup_title",
      "label": "ポップアップタイトル",
      "default": "パーソナルKOJIレシピ提案"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "サブタイトル（説明文）",
      "default": "あなたの今の体調や食事の希望に合わせて<br>MUROの麹製品を使った特別なレシピをご提案します"
    },
    {
      "type": "text",
      "id": "modal_title",
      "label": "モーダルタイトル",
      "default": "あなたのためのレシピ"
    },
    {
      "type": "text",
      "id": "loading_text",
      "label": "ローディングメッセージ",
      "default": "レシピを作成しています..."
    },
    {
      "type": "header",
      "content": "フォーム項目ラベル設定"
    },
    {
      "type": "text",
      "id": "condition_label",
      "label": "体調・お悩みラベル",
      "default": "現在の体調やお悩み(必須)"
    },
    {
      "type": "text",
      "id": "dietary_label",
      "label": "食事注意事項ラベル",
      "default": "食事で気をつけたいこと（任意）"
    },
    {
      "type": "text",
      "id": "koji_label",
      "label": "麹製品ラベル",
      "default": "使用したいMUROの麹製品（任意）"
    },
    {
      "type": "text",
      "id": "ingredients_label",
      "label": "食材ラベル",
      "default": "使いたい食材（任意）"
    },
    {
      "type": "header",
      "content": "プレースホルダー設定"
    },
    {
      "type": "text",
      "id": "condition_placeholder",
      "label": "体調・お悩みのプレースホルダー",
      "default": "例：最近、夏バテ気味で食欲がない"
    },
    {
      "type": "text",
      "id": "dietary_placeholder",
      "label": "食事で気をつけたいことのプレースホルダー",
      "default": "例：ビタミンB群を多く摂りたい"
    },
    {
      "type": "text",
      "id": "ingredients_placeholder",
      "label": "使いたい食材のプレースホルダー",
      "default": "例：鶏むね肉、豆腐"
    }
  ]
}
{% endschema %}